version 23.4R2-S2.1-EVO;
chassis {
    aggregated-devices {
        ethernet {
            device-count 2;
        }
    }
}
interfaces {
    et-0/0/0 {
        flexible-vlan-tagging;
        encapsulation flexible-ethernet-services;
        unit 10 {
            encapsulation vlan-bridge;
            vlan-id 10;
        }
        unit 20 {
            encapsulation vlan-bridge;
            vlan-id 20;
        }
    }
    et-0/0/1 {
        ether-options {
            802.3ad {
                lacp {
                    port-priority 32768;
                }
                ae0;
            }
        }
    }
    et-0/0/9 {
        unit 0 {
            family inet;
            family inet6;
        }
    }
    et-0/0/10 {
        unit 0 {
            family inet;                    
            family inet6;
        }
    }
    et-0/0/11 {
        unit 0 {
            family inet;
            family inet6;
        }
    }
    ae0 {
        flexible-vlan-tagging;
        encapsulation flexible-ethernet-services;
        esi {
            00:24:24:24:24:24:24:00:00:20;
            all-active;
        }
        aggregated-ether-options {
            minimum-links 1;
            lacp {
                active;
                periodic fast;
                system-priority 32k;
                system-id 00:00:00:00:00:20;
                admin-key 1;
            }
        }
        unit 10 {
            encapsulation vlan-bridge;
            vlan-id 10;
        }                                   
        unit 20 {
            encapsulation vlan-bridge;
            vlan-id 20;
        }
    }
    lo0 {
        unit 0 {
            family inet {
                address 10.0.0.3/32;
            }
        }
    }
}
forwarding-options {
    tunnel-termination;
}
policy-options {
    route-filter-list loopback-addresses {
        10.0.0.0/24 orlonger;
    }
    policy-statement accept-evpn {
        term accept-evpn {
            from family evpn;
            then accept;
        }
    }
    policy-statement accept-loopbacks {
        term accept-loopbacks {
            from {
                route-filter-list loopback-addresses;
            }
            then accept;
        }
    }
    policy-statement load-balancing-policy {
        then {
            load-balance per-packet;
        }
    }
}
routing-instances {
    l2evpn-10 {
        instance-type mac-vrf;
        protocols {
            evpn {
                encapsulation vxlan;
                default-gateway do-not-advertise;
                extended-vni-list 10010;
            }
        }
        vtep-source-interface lo0.0;
        service-type vlan-based;
        interface et-0/0/0.10;
        route-distinguisher 10.0.0.3:10010;
        vrf-target target:1:10010;
        vlans {
            bd10010 {
                vlan-id 10;
                interface et-0/0/0.10;
                vxlan {
                    vni 10010;
                }
            }
        }
    }
    l2evpn-mh {
        instance-type mac-vrf;
        protocols {
            evpn {                          
                encapsulation vxlan;
                default-gateway do-not-advertise;
                extended-vni-list 10020;
            }
        }
        vtep-source-interface lo0.0;
        service-type vlan-based;
        interface et-0/0/0.20;
        interface ae0.20;
        route-distinguisher 10.0.0.3:10020;
        vrf-target target:1:10020;
        vlans {
            bd10020 {
                vlan-id 20;
                interface et-0/0/0.20;
                interface ae0.20;
                vxlan {
                    vni 10020;
                }
            }
        }
    }
}
routing-options {
    router-id 10.0.0.3;
    autonomous-system 65003;
    forwarding-table {
        export load-balancing-policy;
        ecmp-fast-reroute;
    }
}
protocols {
    router-advertisement {
        interface et-0/0/9.0;
        interface et-0/0/10.0;
        interface et-0/0/11.0;
    }
    bgp {
        multipath {
            multiple-as;
        }
        group underlay {
            type external;
            peer-as 65000;
            import accept-loopbacks;
            export accept-loopbacks;
            family inet {
                unicast {
                    extended-nexthop;
                }
            }
            bfd-liveness-detection {
                minimum-interval 1000;
            }
            dynamic-neighbor underlay {
                peer-auto-discovery {
                    family inet6 {
                        ipv6-nd;
                    }
                    interface et-0/0/9.0;
                    interface et-0/0/10.0;
                    interface et-0/0/11.0;
                }
            }
        }
        group overlay {
            type internal;
            local-as 65534;
            peer-as 65534;
            multihop {
                ttl 3;
            }
            import accept-evpn;
            export accept-evpn;
            family evpn {
                signaling;
            }
            neighbor 10.0.0.11;
            neighbor 10.0.0.12;
            neighbor 10.0.0.13;
        }
    }
    evpn {
        no-core-isolation;
    }
    lldp {
        interface all;
    }
}